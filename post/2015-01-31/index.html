<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="gdb, gdb调试, gdb调试方法, 多线程调试, 网站, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="gdb调试方法精粹 : frederick.sun"/>
<meta property="og:site_name" content="nanshu wang blog"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://sun-friderick.github.io/post/2015-01-31">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2015-01-31"/>
<meta property="article:modified_time" content="2015-01-31"/>



<meta property="article:tag" content="gdb">
<meta property="article:tag" content="gdb调试">
<meta property="article:tag" content="gdb调试方法">
<meta property="article:tag" content="多线程调试">
<meta property="article:tag" content="网站">





    <base href="http://sun-friderick.github.io/">
    <title> gdb调试方法精粹 - frederick.sun </title>
    <link rel="canonical" href="http://sun-friderick.github.io/post/2015-01-31">
    

    <link href='http://fonts.useso.com/css?family=Fjalla+One|Open+Sans:300' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/static/css/style.css">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?a79535ca63291dc820e3ecefa615aad1";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>

</head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
<header id="header">
	<nav id="nav">
	<div id="title"><a href="/">Frederick Sun</a></div>
    <div><a href=mailto: mrsun.echo@gmail.com target="_blank" class="mailto"> </span> <span class="icon-mail"></span>eric</a></div>
	</nav>
    <nav id="nav">
    	        <ul id="mainnav">
            <li>
                <a href="/bar-work/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span> 
                <span> 工作 </span>
            </a>
            </li>
            <li>
            <a href="/bar-technology/">
                <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
                <span> 技术 </span>
            </a>
            </li>
            <li>
            <a href="/bar-favor/">
                <span class="icon"> <i aria-hidden="true" class="icon-leaf"></i></span>
                <span> 爱好 </span>
            </a>
            </li>
            
            <li>
            <a href="/bar-living/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> 生活 </span>
            </a>
            </li>
            
            <li>
            <a href="/tags/">
                <span class="icon"> <i aria-hidden="true" class="icon-pencil"></i></span>
                <span> Tags </span>
            </a>
            </li>
            
            <li>
            <a href="/about">
                <span class="icon"> <i aria-hidden="true" class="icon-heart"></i></span>
                <span> 关于 </span>
            </a>
            </li>
        </ul>

    </nav>
    <nav id="nav">
       	        <ul id="social">
            
            <li id="share">
                <span class="title"> 友链 </span>
                <div class="dropdown share">
                    <ul class="social">
                      <li> <a href="http://xgezhang.com" target="_blank" title="xge技术博客" class="twitter">xge</a> </li>
                      <li> <a href="http://spf13.com" target="_blank" title="spf13 is Steve Francis" class="facebook">spf13</a> </li>
                      <li> <a href="http://libaier.net" target="_blank" title="Libaier" class="rss">Libaier</a> </li>
                      <li> <a href="http://read.douban.com/column/195295/" target="_blank" title="100个故事" class="douban">一百个故事</a></li>
                      <li> <a href="http://zhangwenli.com/blog/" target="_blank" title="羡辙杂俎" class="yangzhe">羡辙杂俎</a></li>
	      <li> <a href="http://nanshu.wang/" target="_blank" title="Hugo博客" class="hugo">Hugo博客</a></li>
                    </ul>
                <span class="icon icon-bubbles"> </span> <span class="subcount"></span> </div>
            </li>
                
            <li id="follow">
                <span class="title"> 驻留地 </span>
                <div class="dropdown follow">
                    <ul class="social">
                    
                        <li> <a href="http://weibo.com/2235647167/profile/" target="_blank" title="微博" class="weibo">微博</a> </li>
                        <li> <a href="http://www.doc88.com/123_echo_" target="_blank" title="道客巴巴" class="doc88">道客巴巴</a> </li>
                        <li> <a href="http://www.zhihu.com/people/eric-sun-11" target="_blank" title="知乎" class="zhihu">知乎</a> </li>
                        <li> <a href="http://github.com/sun-friderick/" target="_blank" title="GitHub" class="github">GitHub</a> </li>                         
                        <li> <a href="http://www.cnblogs.com/sun-frederick/" target="_blank" title="博客园" class="cnblogs"> 博客园</a></li>
                        <li> <a href="http://instagram.com/ainedrag22" target="_blank" title="Instagram" class="instagram">Instagram</a> </li>
                        
                    </ul>
                <span class="icon icon-rocket"> </span> <span class="subcount"></span> </div>
            </li>
            
            
        </ul>

	</nav>
</header>



<section id="main">
  <h1 itemprop="name" >gdb调试方法精粹</h1>
  

<aside id="meta">

    <div>
        <section id="datecount">
          <h4 id="date"> Sat Jan 31, 2015 </h4>
          
        </section>
        
        <ul id="tags">
          
            <li> <a href="http://sun-friderick.github.io//tags/gdb">gdb</a> </li>
          
            <li> <a href="http://sun-friderick.github.io//tags/gdb%E8%B0%83%E8%AF%95">gdb调试</a> </li>
          
            <li> <a href="http://sun-friderick.github.io//tags/gdb%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95">gdb调试方法</a> </li>
          
            <li> <a href="http://sun-friderick.github.io//tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%B0%83%E8%AF%95">多线程调试</a> </li>
          
            <li> <a href="http://sun-friderick.github.io//tags/%E7%BD%91%E7%AB%99">网站</a> </li>
          
        </ul>
    </div>

</aside>

<meta itemprop="wordCount" content="418">
<meta itemprop="datePublished" content="2015-01-31">
<meta itemprop="url" content="http://sun-friderick.github.io/post/2015-01-31">


  <div>
        <article itemprop="articleBody" id="content">
           <p>#一、多线程调试
###1. 多线程调试,最重要的几个命令:
info threads                        查看当前进程的线程。
                                          GDB会为每个线程分配一个ID, 后面操作线程的时候会用到这个ID.
                                          前面有*的是当前调试的线程.
thread                      切换调试的线程为指定ID的线程。
break file.c:100 thread all    在file.c文件第100行处为所有经过这里的线程设置断点。
set scheduler-locking off|on|step<br />
      在使用step或者continue命令调试当前被调试线程的时候，其他线程也是同时执行的,
      怎么只让被调试程序执行呢？
      通过这个命令就可以实现这个需求。
         off      不锁定任何线程，也就是所有线程都执行，这是默认值。
         on       只有当前被调试程序会执行。
         step     在单步的时候，除了next过一个函数的情况
                  (熟悉情况的人可能知道，这其实是一个设置断点然后continue的行为)以外，
                  只有当前线程会执行。
thread apply ID1 ID2 command        让一个或者多个线程执行GDB命令command
thread apply all command            让所有被调试线程执行GDB命令command。</p>

<p>###2. 使用示例:
线程产生通知：在产生新的线程时, gdb会给出提示信息
&gt;(gdb) r
Starting program: /root/thread
[New Thread 1073951360 (LWP 12900)]
[New Thread 1082342592 (LWP 12907)]&mdash;以下三个为新产生的线程
[New Thread 1090731072 (LWP 12908)]
[New Thread 1099119552 (LWP 12909)]</p>

<p>查看线程：使用info threads可以查看运行的线程。
&gt;(gdb) info threads
  4 Thread 1099119552 (LWP 12940)   0xffffe002 in ?? ()
  3 Thread 1090731072 (LWP 12939)   0xffffe002 in ?? ()
  2 Thread 1082342592 (LWP 12938)   0xffffe002 in ?? ()
* 1 Thread 1073951360 (LWP 12931)   main (argc=1, argv=0xbfffda04) at thread.c:21
(gdb)</p>

<p>注意，行首为gdb分配的线程ID号，对线程进行切换时，使用该ID号码。
另外，行首的星号标识了当前活动的线程
切换线程：
使用 thread THREADNUMBER 进行切换，THREADNUMBER 为上文提到的线程ID号。
下例显示将活动线程从 1 切换至 4。
&gt;(gdb) info threads
   4 Thread 1099119552 (LWP 12940)   0xffffe002 in ?? ()
   3 Thread 1090731072 (LWP 12939)   0xffffe002 in ?? ()
   2 Thread 1082342592 (LWP 12938)   0xffffe002 in ?? ()
* 1 Thread 1073951360 (LWP 12931)   main (argc=1, argv=0xbfffda04) at thread.c:21
(gdb) thread 4
[Switching to thread 4 (Thread 1099119552 (LWP 12940))]#0   0xffffe002 in ?? ()
(gdb) info threads
* 4 Thread 1099119552 (LWP 12940)   0xffffe002 in ?? ()
   3 Thread 1090731072 (LWP 12939)   0xffffe002 in ?? ()
   2 Thread 1082342592 (LWP 12938)   0xffffe002 in ?? ()
   1 Thread 1073951360 (LWP 12931)   main (argc=1, argv=0xbfffda04) at thread.c:21
(gdb)</p>

<p>以上即为使用gdb提供的对多线程进行调试的一些基本命令。
另外，gdb也提供对线程的断点设置以及对指定或所有线程发布命令的命令</p>

<p>#二、调试宏
在GDB下, 我们无法print宏定义，因为宏是预编译的。
但是我们还是有办法来调试宏，这个需要GCC的配合。
在GCC编译程序的时候，加上
  -ggdb3   参数，这样，你就可以调试宏了。</p>

<p>另外，你可以使用下述的GDB的宏调试命令 来查看相关的宏。
info macro   查看这个宏在哪些文件里被引用了，以及宏定义是什么样的。
macro         查看宏展开的样子。</p>

<p>#三、源文件
GDB时,提示找不到源文件。
需要做下面的检查:
编译程序员是否加上了 -g参数 以包含debug信息。
路径是否设置正确了。
使用GDB的directory命令来设置源文件的目录。</p>

<p>下面给一个调试/bin/ls的示例(ubuntu下)
&gt;$ apt-get source coreutils
$ sudo apt-get install coreutils-dbgsym
$ gdb /bin/ls
GNU gdb (GDB) 7.1-ubuntu
(gdb) list main
1192    ls.c: No such file or directory.
in ls.c
(gdb) directory ~/src/coreutils-7.4/src/
Source directories searched: /home/hchen/src/coreutils-7.4:$cdir:$cwd
(gdb) list main
1192        }
1193    }
1194
1195    int
1196    main (int argc, char **argv)
1197    {
1198      int i;
1199      struct pending *thispend;
1200      int n_files;
1201</p>

<p>#四、条件断点
条件断点是语法是：
  break  [where] if [condition]
这种断点真是非常管用。
尤其是在一个循环或递归中，或是要监视某个变量。
注意，这个设置是在GDB中的，只不过每经过那个断点时GDB会帮你检查一下条件是否满足。</p>

<p>#五、命令行参数
有时候，我们需要调试的程序需要有命令行参数, 有三种方法：
gdb命令行的 -args 参数
gdb环境中   set args命令。
gdb环境中   run 参数</p>

<p>#六、gdb的变量
有时候，在调试程序时，我们不单单只是查看运行时的变量，
我们还可以直接设置程序中的变量，以模拟一些很难在测试中出现的情况，比较一些出错，
或是switch的分支语句。使用set命令可以修改程序中的变量。
另外，你知道gdb中也可以有变量吗？
就像shell一样，gdb中的变量以$开头，比如你想打印一个数组中的个个元素，你可以这样：
(gdb) set $i = 0
(gdb) p a[$i++]
&hellip;  #然后就一路回车下去了
当然，这里只是给一个示例，表示程序的变量和gdb的变量是可以交互的。</p>

<p>#七、x命令
也许，你很喜欢用p命令。
所以，当你不知道变量名的时候，你可能会手足无措，因为p命令总是需要一个变量名的。
x命令是用来查看内存的，在gdb中 “help x” 你可以查看其帮助。
x/x 以十六进制输出
x/d 以十进制输出
x/c 以单字符输出
x/i  反汇编 – 通常，我们会使用 x/10i $ip-20 来查看当前的汇编（$ip是指令寄存器）
x/s 以字符串输出</p>

<p>#八、command命令
如何自动化调试。
这里向大家介绍command命令，简单的理解一下，其就是把一组gdb的命令打包，有点像字处理软件的“宏”。
下面是一个示例：
&gt;(gdb) break func
&gt;Breakpoint 1 at 0x3475678: file test.c, line 12.
&gt;(gdb) command 1
&gt;Type commands for when breakpoint 1 is hit, one per line.
&gt;End with a line saying just &ldquo;end&rdquo;.
&gt;print arg1
&gt;print arg2
&gt;print arg3
&gt;end
&gt;(gdb)</p>

<p>当我们的断点到达时，自动执行command中的三个命令，把func的三个参数值打出来。</p>

        </article>
  </div>
</section>

<aside id=comments>
    <div><h2> Comments </h2></div>
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'frederick-sun';
    var disqus_identifier = 'http:\/\/sun-friderick.github.io\/post\/2015-01-31';
    var disqus_title = 'gdb调试方法精粹';
    var disqus_url = 'http:\/\/sun-friderick.github.io\/post\/2015-01-31';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</aside>

<footer>
  <div>
    <p>
    &copy; 2015 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Frederick Sun.</span></span>
        Powered by <a href="http://hugo.spf13.com">Hugo</a>.
        Theme by <a href="http://spf13.com">Steve Francia</a>.
    </p>
  </div>
</footer>
<script type="text/javascript">
(function(){var j=function(a,b){return window.getComputedStyle?getComputedStyle(a).getPropertyValue(b):a.currentStyle[b]};var k=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else a.attachEvent('on'+b,c)};var l=function(a,b){for(key in b)if(b.hasOwnProperty(key))a[key]=b[key];return a};window.fitText=function(d,e,f){var g=l({'minFontSize':-1/0,'maxFontSize':1/0},f);var h=function(a){var b=e||1;var c=function(){a.style.fontSize=Math.max(Math.min(a.clientWidth/(b*10),parseFloat(g.maxFontSize)),parseFloat(g.minFontSize))+'px'};c();k(window,'resize',c)};if(d.length)for(var i=0;i<d.length;i++)h(d[i]);else h(d);return d}})();
fitText(document.getElementById('title'), 1)
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>






<style> 
    BODY {
        min-height:800px;
    }
    #goTopBtn {
        POSITION: fixed; TEXT-ALIGN: center; LINE-HEIGHT: 50px; WIDTH: 50px; BOTTOM: 35px; HEIGHT: 50px; FONT-SIZE: 12px; CURSOR: pointer; RIGHT: 0px; _position: absolute; _right: auto;
    }
</style>
<script type="text/javascript">
    function goTopEx() { 
        var obj = document.getElementById("goTopBtn"); 
        function getScrollTop() { 
            return document.documentElement.scrollTop + document.body.scrollTop; 
        } 
        function setScrollTop(value) { 
            if (document.documentElement.scrollTop) { 
                document.documentElement.scrollTop = value; 
            } else { 
                document.body.scrollTop = value; 
            } 
        } 
        window.onscroll = function() { 
            getScrollTop() > 0 ? obj.style.display = "": obj.style.display = "none"; 
        } 
        obj.onclick = function() { 
            var goTop = setInterval(scrollMove, 10); 
            function scrollMove() { 
                setScrollTop(getScrollTop() / 1.1); 
            if (getScrollTop() < 1) 
                clearInterval(goTop); 
            } 
        } 
    } 
</script>
<div style="display: none" id="goTopBtn"><img src='/media/top.gif' /></div>
<script type="text/javascript">goTopEx();</script>


</body>
</html>


<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</body>&gt; lim
当你的程序被GDB停住时，所有的运行线程都会被停住。这方便查看运行程序的总体情况。而在你恢复程序运行时，所有的线程也会被恢复运行。</p>

<p>10.调试core文件</p>

<p>Core Dump：Core的意思是内存，Dump的意思是扔出来，堆出来。开发和使用Unix程序时，有时程序莫名其妙的down了，却没有任何的提示(有时候会提示core dumped)，这时候可以查看一下有没有形如core.进程号的文件生成，这个文件便是操作系统把程序down掉时的内存内容扔出来生成的, 它可以做为调试程序的参考</p>

<p>(1)生成Core文件
　　一般默认情况下，core file的大小被设置为了0，这样系统就不dump出core file了。修改后才能生成core文件。</p>

<p>　　#设置core大小为无限
　　ulimit -c unlimited
　　#设置文件大小为无限
　　ulimit unlimited</p>

<p>　　这些需要有root权限, 在ubuntu下每次重新打开中断都需要重新输入上面的第一条命令, 来设置core大小为无限</p>

<p>core文件生成路径:输入可执行文件运行命令的同一路径下。若系统生成的core文件不带其他任何扩展名称，则全部命名为core。新的core文件生成将覆盖原来的core文件。</p>

<p>1）/proc/sys/kernel/core_uses_pid可以控制core文件的文件名中是否添加pid作为扩展。文件内容为1，表示添加pid作为扩展名，生成的core文件格式为core.xxxx；为0则表示生成的core文件同一命名为core。
可通过以下命令修改此文件：
echo &ldquo;1&rdquo; &gt; /proc/sys/kernel/core_uses_pid</p>

<p>2）proc/sys/kernel/core_pattern可以控制core文件保存位置和文件名格式。
可通过以下命令修改此文件：
echo &ldquo;/corefile/core-%e-%p-%t&rdquo; &gt; core_pattern，可以将core文件统一生成到/corefile目录下，产生的文件名为core-命令名-pid-时间戳
以下是参数列表:
    %p - insert pid into filename 添加pid
    %u - insert current uid into filename 添加当前uid
    %g - insert current gid into filename 添加当前gid
    %s - insert signal that caused the coredump into the filename 添加导致产生core的信号
    %t - insert UNIX time that the coredump occurred into filename 添加core文件生成时的unix时间
    %h - insert hostname where the coredump happened into filename 添加主机名
    %e - insert coredumping executable name into filename 添加命令名</p>

<p>(2)用gdb查看core文件</p>

<p>　　发生core dump之后, 用gdb进行查看core文件的内容, 以定位文件中引发core dump的行.
　　gdb [exec file] [core file]
　　如:
　　gdb ./test core</p>

<p>　　或gdb ./a.out
 　　core-file core.xxxx
　　gdb后, 用bt命令backtrace或where查看程序运行到哪里, 来定位core dump的文件-&gt;行.</p>

<p>　　待调试的可执行文件，在编译的时候需要加-g，core文件才能正常显示出错信息</p>

<p>　　1）gdb -core=core.xxxx
　　file ./a.out
　　bt
　　2）gdb -c core.xxxx
　　file ./a.out
　　bt</p>

<p>(3)用gdb实时观察某进程crash信息</p>

<p>　　启动进程
　　gdb -p PID
　　c
　　运行进程至crash
　　gdb会显示crash信息
　　bt</p>

<p>#gdb调试命令说明</p>

<h1 id="1-对于在应用程序中加入参数进行调试的方法:a705e2985626516966a98e6f6a34e407">1: 对于在应用程序中加入参数进行调试的方法：</h1>

<p>直接用 gdb app -p1 -p2 这样进行调试是不行的。
   需要像以下这样使用：
    #gdb app
    (gdb) r -p1 -p2
    或者在运行run命令前使用set args命令：
    （gdb） set args p1 p2
    可以用show args 命令来查看</p>

<h1 id="2-加入断点:a705e2985626516966a98e6f6a34e407">2. 加入断点：</h1>

<p>break <linenumber>
   break <funcName>
   break +offset
   break -offset
   (在当前行号的前面或后面的offset行停住。)</p>

<p>break filename:linenum
   在源文件filename的linenum行处停住。</p>

<p>break filename:function
   在源文件filename的function函数的入口处停住。</p>

<p>break &hellip; if
  &hellip;可以是上述的参数，condition表示条件，在条件成立时停住。比如在循环境体中，可以设置     break if i=100，表示当i为100时停住程序。</p>

<h1 id="3-查看运行时的堆栈:a705e2985626516966a98e6f6a34e407">3. 查看运行时的堆栈：</h1>

<p>使用bt命令</p>

<h1 id="4-打印某个变量的值:a705e2985626516966a98e6f6a34e407">4. 打印某个变量的值：</h1>

<p>print val</p>

<h1 id="5-单步-n:a705e2985626516966a98e6f6a34e407">5. 单步： n</h1>

<p>继续运行：　c
　　step
　　单步跟踪，如果有函数调用，他会进入该函数。
　　next
　　同样单步跟踪，如果有函数调用，他不会进入该函数。很像VC等工具中的step over。后面可以加count也可以不加，不加表示一条条地执行，加表示执行后面的count条指令，然后再停住。
　　set step-mode
　　set step-mode on
　　打开step-mode模式，于是，在进行单步跟踪时，程序不会因为没有debug信息而不停住。这个参数有很利于查看机器码。
　　set step-mod off
　　关闭step-mode模式。
　　finish
　　运行程序，直到当前函数完成返回。并打印函数返回时的堆栈地址和返回值及参数值等信息。
　　until 或 u
　　当你厌倦了在一个循环体内单步跟踪时，这个命令可以运行程序直到退出循环体。</p>

<h1 id="6-在gdb中执行shell命令:a705e2985626516966a98e6f6a34e407">6.在gdb中执行shell命令：</h1>

<p>　在gdb环境中，你可以执行UNIX的shell的命令，使用gdb的shell命令来完成：
　eg. shell make</p>

<h1 id="7-运行环境:a705e2985626516966a98e6f6a34e407">7. 运行环境</h1>

<p>可设定程序的运行路径。
  show paths 查看程序的运行路径。
  set environment varname [=value] 设置环境变量。如：set env USER=hchen
  show environment [varname] 查看环境变量。</p>

<h1 id="8-观察点-watchpoint:a705e2985626516966a98e6f6a34e407">8.观察点（WatchPoint）</h1>

<p>观察点一般来观察某个表达式（变量也是一种表达式）的值是否有变化了，如果有变化，马上停住程 序。我们有下面的几种方法来设置观察点：
  watch
   为表达式（变量）expr设置一个观察点。一量表达式值有变化时，马上停住程序。
  rwatch
   当表达式（变量）expr被读时，停住程序。
  awatch
   当表达式（变量）的值被读或被写时，停住程序。
  info watchpoints
   列出当前所设置了的所有观察点。</p>

<h1 id="9-维护breakpoint:a705e2985626516966a98e6f6a34e407">9. 维护breakpoint</h1>

<p>clear
    清除所有的已定义的停止点。
   clear func
    清除所有设置在函数上的停止点。
  delete [breakpoints] [range&hellip;]
  删除指定的断点，breakpoints为断点号。如果不指定断点号，则表示删除所有的断点。range 表示断点号的范围（如：3-7）。其简写命令为d。
  比删除更好的一种方法是disable停止点，disable了的停止点，GDB不会删除，当你还需要时，enable即可，就好像回收站一样。
  disable [breakpoints] [range&hellip;]
   disable所指定的停止点，breakpoints为停止点号。如果什么都不指定，表示disable所有的停止 点。简写命令是dis.
  enable [breakpoints] [range&hellip;]
   enable所指定的停止点，breakpoints为停止点号。</p>

<h1 id="10-程序变量:a705e2985626516966a98e6f6a34e407">10、程序变量</h1>

<p>查看文件中某变量的值：
file::variable
function::variable
可以通过这种形式指定你所想查看的变量，是哪个文件中的或是哪个函数中的。例如，查看文件f2.c中的全局变量x的值：
gdb) p &lsquo;f2.c&rsquo;::x</p>

<p>查看数组的值
有时候，你需要查看一段连续的内存空间的值。比如数组的一段，或是动态分配的数据的大小。你可以使用GDB的“@”操作符，“@”的左边是第一个内存的地址的值，“@”的右边则你你想查看内存的长度。例如，你的程序中有这样的语句：
int *array = (int *) malloc (len * sizeof (int));
于是，在GDB调试过程中，你可以以如下命令显示出这个动态数组的取值：
p *array@len
如果是静态数组的话，可以直接用print数组名，就可以显示数组中所有数据的内容了。</p>

<h1 id="10-1-输出格式:a705e2985626516966a98e6f6a34e407">10-1.输出格式</h1>

<p>一般来说，GDB会根据变量的类型输出变量的值。但你也可以自定义GDB的输出的格式。例如，你想输出一个整数的十六进制，或是二进制来查看这个整型变量的中的位的情况。要做到这样，你可以使用GDB的数据显示格式：</p>

<p>x 按十六进制格式显示变量。
d 按十进制格式显示变量。
u 按十六进制格式显示无符号整型。
o 按八进制格式显示变量。
t 按二进制格式显示变量。
a 按十六进制格式显示变量。
c 按字符格式显示变量。
f 按浮点数格式显示变量。
(gdb) p i
$21 = 101
(gdb) p/a i
$22 = 0x65
(gdb) p/c i
$23 = 101 &lsquo;e&rsquo;
(gdb) p/f i
$24 = 1.41531145e-43
(gdb) p/x i
$25 = 0x65
(gdb) p/t i
$26 = 1100101</p>

<h1 id="11-查看内存:a705e2985626516966a98e6f6a34e407">11.查看内存</h1>

<p>使用examine命令（简写是x）来查看内存地址中的值。x命令的语法如下所示：
x/
n、f、u是可选的参数。
n 是一个正整数，表示显示内存的长度，也就是说从当前地址向后显示几个地址的内容。
f 表示显示的格式，参见上面。如果地址所指的是字符串，那么格式可以是s，如果地十是指令地址，那么格式可以是i。
u 表示从当前地址往后请求的字节数，如果不指定的话，GDB默认是4个bytes。u参数可以用下面的字符来代替，b表示单字节，h表示双字节，w表示四字节，g表示八字节。当我们指定了字节长度后，GDB会从指内存定的内存地址开始，读写指定字节，并把其当作一个值取出来。</p>

<p>n/f/u三个参数可以一起使用。例如：
命令：x/3uh 0x54320 表示，从内存地址0x54320读取内容，h表示以双字节为一个单位，3表示三个单位，u表示按十六进制显示。</p>

<h1 id="12-自动显示:a705e2985626516966a98e6f6a34e407">12.自动显示</h1>

<p>你可以设置一些自动显示的变量，当程序停住时，或是在你单步跟踪时，这些变量会自动显示。相关的GDB命令是display。
display
display/
display/ expr
expr是一个表达式，fmt表示显示的格式，addr表示内存地址，当你用display设定好了一个或多个表达式后，只要你的程序被停下来，GDB会自动显示你所设置的这些表达式的值。</p>

<p>格式i和s同样被display支持，一个非常有用的命令是：
display/i $pc</p>

<p>undisplay
delete display
删除自动显示，dnums意为所设置好了的自动显式的编号。</p>

<p>disable display
enable display
disable和enalbe不删除自动显示的设置，而只是让其失效和恢复。</p>

<p>info display
查看display设置的自动显示的信息。GDB会打出一张表格，向你报告当然调试中设置了多少个自动显示设置，其中包括，设置的编号，表达式，是否enable。</p>

<h1 id="13-设置显示选项:a705e2985626516966a98e6f6a34e407">13. 设置显示选项</h1>

<p>set print address
set print address on
打开地址输出，当程序显示函数信息时，GDB会显出函数的参数地址。系统默认为打开的，
show print address
查看当前地址显示选项是否打开。</p>

<p>set print array
set print array on
打开数组显示，打开后当数组显示时，每个元素占一行，如果不打开的话，每个元素则以逗号分隔。这个选项默认是关闭的。与之相关的两个命令如下，我就不再多说了。</p>

<p>set print array off
show print array</p>

<p>set print elements
这个选项主要是设置数组的，如果你的数组太大了，那么就可以指定一个来指定数据显示的最大长度，当到达这个长度时，GDB就不再往下显示了。如果设置为0，则表示不限制。</p>

<p>show print elements
查看print elements的选项信息。</p>

<p>set print null-stop
如果打开了这个选项，那么当显示字符串时，遇到结束符则停止显示。这个选项默认为off。</p>

<p>set print pretty on
如果打开printf pretty这个选项，那么当GDB显示结构体时会比较漂亮。</p>

<h1 id="14-关于显示源码list:a705e2985626516966a98e6f6a34e407">14.关于显示源码list</h1>

<p>以下是list命令的說明。
參數                                     說明
list filename:number  列出某檔案的第幾行，檔案是可省略的。
list [function]                  列出某函數的程式碼
list                                       繼續印出程式碼
list -                                     印出上一次list的程式碼的前一段程式碼(類似向上翻動)
show listsize   顯示現在一次印出幾行
set listsize  設定一次印出幾行</p>

<p>备常用命令：</p>

<h2 id="１-常看源码-list-ｌ:a705e2985626516966a98e6f6a34e407">１.常看源码：list（ｌ）　</h2>

<p>　　list　＜linenumber＞　行号
　　list　＜＋offset＞　当前行号的正偏移
　　list　＜－offset＞　当前行号的负偏移
　　list　＜filename：linenumber＞　哪个文件的哪一行
　　list　＜function＞　函数名
　　list　＜filename：function＞　文件的哪个函数
　　list　＜＊address＞　程序运行时语句在内存中的地址</p>

<h2 id="２-设置断点-break-ｂ:a705e2985626516966a98e6f6a34e407">２．设置断点：break（ｂ）</h2>

<p>　　break　＜function＞　指定函数断点
　　break　＜linenumber＞　指定行号断点
　　break　＜＋offset／－offset＞　当前行号的正／负偏移
　　break　＜filename：linenumber＞　哪个文件的哪一行
　　break　＜＊address＞　运行中的内存地址
　　break　不带参数，下一条指令停止处
　　break &hellip;　if　＜condition＞　在运行中，当condition条件满足时停止。
　　　　ｅｇ．　break　if　ｉ＝100 //当i=100时，立即停止
                 break foo if i=100   //断点设置在foo中，断点条件是i-100, 一点在函数foo中，i的值等于100,被停止。</p>

<h2 id="３-查看信息-info:a705e2985626516966a98e6f6a34e407">３．查看信息： info</h2>

<p>　　info　break　查看断点信息
    info locals 打印出当前函数中所有局部变量及其值
　　info　stack　查看栈中信息
    info frame 更详细的栈层地址信息
　　info　args　查看参数信息
　　info　registers／info　all－registers　查看（所有）寄存器信息
　　info　sources　查看项目的源代码信息</p>

<h2 id="４-维护breakpoint-disable-enable-clear-delete:a705e2985626516966a98e6f6a34e407">４．维护breakpoint：disable/enable/clear/delete</h2>

<pre><code> disable(dis) 【breakpoints】 【range...】
   如果没有参数，则停止所有的断点，
 enable 【breakpoints】【range】
 clear &lt;function&gt;/&lt;filename:function&gt;/&lt;linenum&gt;/&lt;filename:linenum&gt;
    清楚已定义的停止点
  delete [breakpoints] [ranga...]
     删除指定的断点
</code></pre>

<h2 id="５-恢复程序运行:a705e2985626516966a98e6f6a34e407">５．恢复程序运行：</h2>

<p>　　continue（c）
　　</p>

<h2 id="6-until和finish:a705e2985626516966a98e6f6a34e407">6.until和finish</h2>

<p>until 跳出循环比较有用
    help finish
     Execute until selected stack frame returns.
     Upon return, the value returned is printed and put in the value history.
  finish 用来跳出函数比较有用。
    help until
     Execute until the program reaches a source line greater than the current
     or a specified location (same args as break command) within the current frame</p>

<p>##一、多线程调试<br />
多线程调试重要就是下面几个命令：<br />
info thread 查看当前进程的线程。<br />
thread <ID> 切换调试的线程为指定ID的线程。<br />
break file.c:100 thread all  在file.c文件第100行处为所有经过这里的线程设置断点。   set scheduler-locking off|on|step，这个是问得最多的。<br />
  * 在使用step或者continue命令调试当前被调试线程的时候，其他线程也是同时执行的，怎么只让被调试程序执行呢？通过这个命令就可以实现这个需求。<br />
  * off 不锁定任何线程，也就是所有线程都执行，这是默认值。<br />
  * on 只有当前被调试程序会执行。<br />
  * step 在单步的时候，除了next过一个函数的情况(熟悉情况的人可能知道，这其实是一个设置断点然后continue的行为)以外，只有当前线程会执行。</p>

<p>##二、调试宏
这个问题超多。在GDB下，我们无法print宏定义，因为宏是预编译的。但是我们还是有办法来调试宏，这个需要GCC的配合。<br />
在GCC编译程序的时候，加上-ggdb3参数，这样，你就可以调试宏了。<br />
另外，你可以使用下述的GDB的宏调试命令 来查看相关的宏。<br />
info macro – 你可以查看这个宏在哪些文件里被引用了，以及宏定义是什么样的。<br />
macro – 你可以查看宏展开的样子。</p>

<p>##三、源文件
这个问题问的也是很多的，太多的朋友都说找不到源文件。在这里我想提醒大家做下面的检查：<br />
编译程序员是否加上了-g参数以包含debug信息。 路径是否设置正确了。使用GDB的directory命令来设置源文件的目录。<br />
下面给一个调试/bin/ls的示例（ubuntu下）</p>

<pre><code>$ apt-get sourcecoreutils  
$ sudoapt-get installcoreutils-dbgsym  
$ gdb /bin/ls  
GNU gdb (GDB) 7.1-ubuntu  
(gdb) list main  
1192    ls.c: No such fileor directory.  
inls.c  
(gdb) directory ~/src/coreutils-7.4/src/  
Source directories searched: /home/hchen/src/coreutils-7.4:$cdir:$cwd  
(gdb) list main  
1192        }  
1193    }  
1194  
1195    int  
1196    main (int argc, char **argv)  
1197    {  
1198      int i;  
1199      struct pending *thispend;  
1200      int n_files;  
1201  
</code></pre>

<p>##四、条件断点
条件断点是语法是：<code>break  [where] if [condition]</code>，这种断点真是非常管用。尤其是在一个循环或递归中，或是要监视某个变量。<br />
注意，这个设置是在GDB中的，只不过每经过那个断点时GDB会帮你检查一下条件是否满足。</p>

<p>##五、命令行参数
有时候，我们需要调试的程序需要有命令行参数，很多朋友都不知道怎么设置调试的程序的命令行参数。<br />
其实，有两种方法：<br />
- gdb命令行的 –args 参数<br />
- gdb环境中 set args命令。</p>

<p>##六、gdb的变量
有时候，在调试程序时，我们不单单只是查看运行时的变量，我们还可以直接设置程序中的变量，以模拟一些很难在测试中出现的情况，比较一些出错，或是switch的分支语句。使用set命令可以修改程序中的变量。<br />
另外，你知道gdb中也可以有变量吗？就像shell一样，gdb中的变量以$开头，比如你想打印一个数组中的个个元素，你可以这样：</p>

<pre><code>(gdb) set$i = 0

(gdb) p a[$i++]

...  #然后就一路回车下去了
</code></pre>

<p>当然，这里只是给一个示例，表示程序的变量和gdb的变量是可以交互的。</p>

<p>##七、x命令
也许，你很喜欢用p命令。所以，当你不知道变量名的时候，你可能会手足无措，因为p命令总是需要一个变量名的。x命令是用来查看内存的，在gdb中 “help x” 你可以查看其帮助。<br />
- x/x 以十六进制输出<br />
- x/d 以十进制输出<br />
- x/c 以单字符输出<br />
- x/i  反汇编 – 通常，我们会使用 x/10i $ip-20 来查看当前的汇编（$ip是指令寄存器）<br />
- x/s 以字符串输出</p>

<p>##八、command命令
有一些朋友问我如何自动化调试。这里向大家介绍command命令，简单的理解一下，其就是把一组gdb的命令打包，有点像字处理软件的“宏”。下面是一个示例：</p>

<pre><code>(gdb) breakfunc
Breakpoint 1 at 0x3475678: filetest.c, line 12.
(gdb) command1
Type commands forwhen breakpoint 1 is hit, one per line.
End with a line saying just &quot;end&quot;.
&gt;print arg1
&gt;print arg2
&gt;print arg3
&gt;end
(gdb)
</code></pre>

<p>当我们的断点到达时，自动执行command中的三个命令，把func的三个参数值打出来。</p>

<p>#设置core环境
uname -a 查看机器参数<br />
ulimit -a 查看默认参数<br />
ulimit -c 1024  设置core文件大小为1024<br />
ulimit -c unlimit 设置core文件大小为无限</p>

<p>多线程如果dump，多为段错误，一般都涉及内存非法读写。可以这样处理，使用下面的命令打开系统开关，让其可以在死掉的时候生成 core文件。<br />
ulimit -c unlimited</p>

<p>#线程调试命令
1. (gdb)info threads<br />
显示当前可调试的所有线程，每个线程会有一个GDB为其分配的ID，后面操作线程的时候会用到这个ID。
前面有*的是当前调试的线程。</p>

<ol>
<li><p>(gdb)thread ID<br />
切换当前调试的线程为指定ID的线程。</p></li>

<li><p>(gdb)thread apply ID1 ID2 command<br />
让一个或者多个线程执行GDB命令command。</p></li>

<li><p>(gdb)thread apply all command<br />
让所有被调试线程执行GDB命令command。</p></li>

<li><p>(gdb)set scheduler-locking off|on|step<br />
估计是实际使用过多线程调试的人都可以发现，在使用step或者continue命令调试当前被调试线程的时候，其他线程也是同时执行的，怎么只让被调试程序执行呢？通过这个命令就可以实现这个需求。</p></li>

<li><p>off 不锁定任何线程，也就是所有线程都执行，这是默认值。</p></li>

<li><p>on 只有当前被调试程序会执行。</p></li>

<li><p>step 在单步的时候，除了next过一个函数的情况(熟悉情况的人可能知道，这其实是一个设置断点然后continue的行为)以外，只有当前线程会执行。</p></li>
</ol>

<p>//显示线程堆栈信息<br />
6. (gdb) bt<br />
察看所有的调用栈</p>

<ol>
<li><p>(gdb) f 3
调用框层次</p></li>

<li><p>(gdb) i locals<br />
显示所有当前调用栈的所有变量</p></li>
</ol>

        </article>
  </div>
</section>

<aside id=comments>
    <div><h2> Comments </h2></div>
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'frederick-sun';
    var disqus_identifier = 'http:\/\/sun-friderick.github.io\/post\/2015-01-31';
    var disqus_title = 'gdb调试命令的使用及总结';
    var disqus_url = 'http:\/\/sun-friderick.github.io\/post\/2015-01-31';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</aside>

<footer>
  <div>
    <p>
    &copy; 2015 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Frederick Sun.</span></span>
        Powered by <a href="http://hugo.spf13.com">Hugo</a>.
        Theme by <a href="http://spf13.com">Steve Francia</a>.
    </p>
  </div>
</footer>
<script type="text/javascript">
(function(){var j=function(a,b){return window.getComputedStyle?getComputedStyle(a).getPropertyValue(b):a.currentStyle[b]};var k=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else a.attachEvent('on'+b,c)};var l=function(a,b){for(key in b)if(b.hasOwnProperty(key))a[key]=b[key];return a};window.fitText=function(d,e,f){var g=l({'minFontSize':-1/0,'maxFontSize':1/0},f);var h=function(a){var b=e||1;var c=function(){a.style.fontSize=Math.max(Math.min(a.clientWidth/(b*10),parseFloat(g.maxFontSize)),parseFloat(g.minFontSize))+'px'};c();k(window,'resize',c)};if(d.length)for(var i=0;i<d.length;i++)h(d[i]);else h(d);return d}})();
fitText(document.getElementById('title'), 1)
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>






<style> 
    BODY {
        min-height:800px;
    }
    #goTopBtn {
        POSITION: fixed; TEXT-ALIGN: center; LINE-HEIGHT: 50px; WIDTH: 50px; BOTTOM: 35px; HEIGHT: 50px; FONT-SIZE: 12px; CURSOR: pointer; RIGHT: 0px; _position: absolute; _right: auto;
    }
</style>
<script type="text/javascript">
    function goTopEx() { 
        var obj = document.getElementById("goTopBtn"); 
        function getScrollTop() { 
            return document.documentElement.scrollTop + document.body.scrollTop; 
        } 
        function setScrollTop(value) { 
            if (document.documentElement.scrollTop) { 
                document.documentElement.scrollTop = value; 
            } else { 
                document.body.scrollTop = value; 
            } 
        } 
        window.onscroll = function() { 
            getScrollTop() > 0 ? obj.style.display = "": obj.style.display = "none"; 
        } 
        obj.onclick = function() { 
            var goTop = setInterval(scrollMove, 10); 
            function scrollMove() { 
                setScrollTop(getScrollTop() / 1.1); 
            if (getScrollTop() < 1) 
                clearInterval(goTop); 
            } 
        } 
    } 
</script>
<div style="display: none" id="goTopBtn"><img src='/media/top.gif' /></div>
<script type="text/javascript">goTopEx();</script>


</body>
</html>


<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</body>